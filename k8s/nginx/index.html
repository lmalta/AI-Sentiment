<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Analyse de Sentiment</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background: #f5f5f5; }
  #smiley {
    position: absolute;
    font-size: 80px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: transform 0.3s ease;
    pointer-events: none;
  }
  #chart-container {
    position: relative;
    width: 300px;
    height: 300px;
    margin: 30px auto;
  }
  input, button { padding: 10px; font-size: 16px; margin-top: 20px; border-radius: 5px; border: 1px solid #ccc; }
  button { cursor: pointer; background: #007bff; color: white; border: none; }
  button:hover { background: #0056b3; }
</style>
</head>
<body>

<h1>Analyse de Sentiment</h1>

<input type="text" id="textInput" placeholder="Tapez une phrase..." size="50" onkeypress="if(event.key==='Enter') analyzeText()">
<button onclick="analyzeText()">Analyser</button>

<div id="chart-container">
  <canvas id="chart"></canvas>
  <div id="smiley">üòê</div>
</div>

<script>
let chart;

async function analyzeText() {
    const text = document.getElementById('textInput').value;
    if (!text) return;

    const response = await fetch(`/api/analyze?text=${encodeURIComponent(text)}`);
    const data = await response.json();

    const result = data[0];
    const label = result.label;
    const score = result.score;

    const positiveColor = 'rgba(0, 200, 0, 0.7)';
    const negativeColor = 'rgba(200, 0, 0, 0.7)';
    const neutralColor = 'rgba(200, 200, 200, 0.3)';

    const chartData = {
        labels: [label, 'reste'],
        datasets: [{
            data: [0, 100], // animation from 0
            backgroundColor: [label === 'POSITIVE' ? positiveColor : negativeColor, neutralColor],
            borderWidth: 1
        }]
    };

    const ctx = document.getElementById('chart').getContext('2d');
    if(chart) chart.destroy();

    chart = new Chart(ctx, {
        type: 'doughnut',
        data: chartData,
        options: {
            cutout: '70%',
            plugins: { legend: { display: false } },
            animation: { duration: 800, easing: 'easeOutQuart' }
        }
    });

    // Animation progressive du score
    let progress = 0;
    const target = score * 100;
    const step = target / 50; // animation en 50 √©tapes
    const interval = setInterval(() => {
        progress += step;
        if (progress >= target) progress = target;
        chart.data.datasets[0].data[0] = progress;
        chart.data.datasets[0].data[1] = 100 - progress;
        chart.update();
        if (progress >= target) clearInterval(interval);
    }, 15);

    // Smiley anim√©
    const smiley = document.getElementById('smiley');
    smiley.style.transform = 'translate(-50%, -50%) scale(1.3)';
    smiley.innerText = label === 'POSITIVE' ? 'üòä' : 'üòû';
    setTimeout(() => { smiley.style.transform = 'translate(-50%, -50%) scale(1)'; }, 300);
}
</script>

</body>
</html>
